<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onore.project.mapper.DailySalesMapper">
	<select id="getDailySales" resultType="com.onore.project.admin.vo.DailySalesVO"> 
		SELECT
		    a.dt AS day , 
		    NVL(SUM(b.total_price), 0) AS daily_sales,
		    NVL(COUNT(b.total_price), 0) AS daily_sales_cnt
		FROM
		    (SELECT TO_CHAR(SYSDATE-7 + LEVEL, 'YYYY.MM.DD') AS dt
		     FROM dual
		     <![CDATA[CONNECT BY LEVEL <= 7) a,]]>
		    (SELECT TO_CHAR(order_date, 'YYYY.MM.DD') AS day , total_price
		     FROM orders
		     WHERE order_date BETWEEN TO_CHAR(sysdate-6,'YYYY.MM.DD') AND TO_CHAR(sysdate+1 , 'YYYY.MM.DD')) b
		WHERE a.dt = b.day(+)
		GROUP BY a.dt
		ORDER BY a.dt DESC
	</select>
</mapper>